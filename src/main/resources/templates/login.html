<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
    <h1>Login</h1>
    <div th:if="${erro}" style="color: red; margin-bottom: 1rem;"> 
        <p th:text="${erro}"></p>
    </div>
    <div th:if="${sucesso}" style="color: green; margin-bottom: 1rem;"> 
        <p th:text="${sucesso}"></p>
    </div>
    <form method="post" action="/login">
        <label for="email">Email:</label>
        <input id="email" name="email" type="email" required />
        <br />
        <label for="senha">Senha:</label>
        <input id="senha" name="senha" type="password" required minlength="6" />
        <br />
        <button type="submit">Entrar</button>
    </form>

    <hr />
    <h2>Cadastro</h2>
    <div id="cadastro-mensagem" style="margin-bottom: 1rem; color: green;"></div>
    <form id="cadastroForm">
        <label for="nome">Nome:</label>
        <input id="nome" name="nome" type="text" required />
        <br />
        <label for="emailCadastro">Email:</label>
        <input id="emailCadastro" name="email" type="email" required />
        <br />
        <label for="senhaCadastro">Senha:</label>
        <input id="senhaCadastro" name="senha" type="password" required minlength="6" />
        <br />
        <button type="submit">Cadastrar</button>
    </form>

    <script>
        const form = document.getElementById('cadastroForm');
        const mensagemDiv = document.getElementById('cadastro-mensagem');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            mensagemDiv.style.color = 'green';
            mensagemDiv.textContent = 'Enviando...';

            const nome = document.getElementById('nome').value;
            const email = document.getElementById('emailCadastro').value;
            const senha = document.getElementById('senhaCadastro').value;

            try {
                const resp = await fetch('/api/usuarios', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nome, email, senha })
                });

                const data = await resp.json().catch(() => ({}));

                if (resp.ok || resp.status === 201) {
                    mensagemDiv.style.color = 'green';
                    mensagemDiv.textContent = data.mensagem || 'Cadastro realizado com sucesso!';
                    form.reset();
                } else {
                    mensagemDiv.style.color = 'red';
                    mensagemDiv.textContent = data.mensagem || ('Erro: status ' + resp.status);
                }
            } catch (err) {
                mensagemDiv.style.color = 'red';
                mensagemDiv.textContent = 'Erro de rede: ' + err.message;
            }
        });
    </script>
</body>
</html>
